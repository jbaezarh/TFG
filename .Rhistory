collect_metrics() %>%
# filter(.metric == "accuracy") %>%
ggplot(aes(x = cost_complexity, y = mean,col=.metric)) +
geom_point() +
geom_line() +
ylab("Medidas de rendimiento") +
scale_x_log10(labels = scales::label_number())
dt_plot
dt_best <- dt_res |>
select_best(metric = "accuracy")
dt_res |> collect_predictions(parameters = dt_best) |> get_metrics()
dt_workflow %>%
finalize_workflow(dt_best) %>%
fit(training) %>%
extract_fit_engine() |> plot()
dt_workflow %>%
finalize_workflow(dt_best) %>%
fit(training) %>%
extract_fit_engine()
lrs_pred = cbind(predict(dt_res,new_data = validation(splits),type="class"),
predict(dt_res,new_data = validation(splits),type="prob"),
fire = validation(splits)$fire)
dt_best <- dt_res |>
select_best(metric = "accuracy")
find_rstudio_root_file()
library(rprojroot)
find_rstudio_root_file()
library(tidyverse)
library(skimr)
library(sf)
library(corrplot)
library(GGally) # Coordenadas paralelas
library(ggpubr)
# load("salidas_intermedias/dataset_completo2024-03-27.RData")
load("salidas_intermedias/dataset_strat_completo2024-04-26.RData")
str(dataset)
datos = dataset |>
select(-c(YEAR,MM,DD))
summary(datos)
datos <- datos |>
mutate(fire = as.factor(fire),
enp = as.factor(enp),
uso_suelo = as.factor(uso_suelo))
```{r}
datos = datos |>
mutate(orientacion = cut(orientacion,
breaks = c(-Inf,-1,22.5,67.5,112.5,157.5,202.5,247.5,292.5,337.5,360),
labels = c("Plano","N","NE","E","SE","S","SW","W","NW","N")))
datos = datos |>
mutate(WD10M = cut(WD10M,
breaks = c(0,22.5,67.5,112.5,157.5,202.5,247.5,292.5,337.5,360),
labels = c("N","NE","E","SE","S","SW","W","NW","N")))
datos <- datos |>
mutate(uso_suelo = uso_suelo |>
as.character() |>
str_sub(0,2) |>
as.factor())
summary(datos)
Andalucia <- esp_get_ccaa(ccaa = "Andalucía")
andalucia_proj <- st_transform(Andalucia,st_crs(dataset))
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "D:/usuario/Documents/Universidad/5º/TFG - organizado") # Para que haga knitr desde el directorio del proyecto
# Librerías:
library(tidyverse) # Manipulación de datos
library(sf) # Vector data
library(terra) # Raster data
library(mapSpain) # Polígonos de regiones de España
library(magrittr) # Operador %<>%
# Chunk 2
# load("salidas_intermedias/dataset_completo2024-03-27.RData")
load("salidas_intermedias/dataset_strat_completo2024-04-26.RData")
str(dataset)
# Chunk 3
datos = dataset |>
select(-c(YEAR,MM,DD))
# Chunk 4
summary(datos)
# Chunk 5
datos <- datos |>
mutate(fire = as.factor(fire),
enp = as.factor(enp),
uso_suelo = as.factor(uso_suelo))
# Chunk 6
datos = datos |>
mutate(orientacion = cut(orientacion,
breaks = c(-Inf,-1,22.5,67.5,112.5,157.5,202.5,247.5,292.5,337.5,360),
labels = c("Plano","N","NE","E","SE","S","SW","W","NW","N")))
# Chunk 7
datos = datos |>
mutate(WD10M = cut(WD10M,
breaks = c(0,22.5,67.5,112.5,157.5,202.5,247.5,292.5,337.5,360),
labels = c("N","NE","E","SE","S","SW","W","NW","N")))
# Chunk 8
datos <- datos |>
mutate(uso_suelo = uso_suelo |>
as.character() |>
str_sub(0,2) |>
as.factor())
# Chunk 9
summary(datos)
Andalucia <- esp_get_ccaa(ccaa = "Andalucía")
andalucia_proj <- st_transform(Andalucia,st_crs(dataset))
plot(st_geometry(andalucia_proj),reset=F)
datos |>
filter(is.na(pendiente)| is.na(orientacion) | is.na(curvatura)) |>
st_geometry() |>
plot(pch=16,col="red",add=T)
datos |>
st_drop_geometry() |>
filter(is.na(pendiente)| is.na(orientacion) | is.na(curvatura)) |>
count() #53 observaciones NA
datos |>
st_drop_geometry() |>
filter(is.na(poblacion)) |>
mutate(Año = year(date)) |>
select(Año,municipio,cod_municipio)
datos |>
st_drop_geometry() |>
filter(is.na(poblacion)) |>
count()
pob = read_csv2("D:/usuario/Documents/Universidad/5º/TFG - organizado/data_raw/antropologicas/Población/poblacion_municipios.txt")[,c(1:5)]
pob |> filter(CODIGO_INE3 == "18077")
datos |>
st_drop_geometry() |>
filter(is.na(poblacion)) |>
count()
pob = read_csv2("D:/usuario/Documents/Universidad/5º/TFG - organizado/data_raw/antropologicas/Población/poblacion_municipios.txt")[,c(1:5)]
pob |> filter(CODIGO_INE3 == "18077")
datos %<>% filter(!is.na(poblacion))
plot(st_geometry(andalucia_proj),reset=F)
dataset |> filter(is.na(uso_suelo)) |> st_geometry() |> plot(pch=16,col="red",add=T)
datos = datos |>
filter(!is.na(uso_suelo))
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "D:/usuario/Documents/Universidad/5º/TFG - organizado") # Para que haga knitr desde el directorio del proyecto
# Librerías:
library(tidyverse) # Manipulación de datos
library(sf) # Vector data
library(terra) # Raster data
library(mapSpain) # Polígonos de regiones de España
library(magrittr) # Operador %<>%
# Chunk 2
# load("salidas_intermedias/dataset_completo2024-03-27.RData")
load("salidas_intermedias/dataset_strat_completo2024-04-26.RData")
str(dataset)
# Chunk 3
datos = dataset |>
select(-c(YEAR,MM,DD))
# Chunk 4
summary(datos)
# Chunk 5
datos <- datos |>
mutate(fire = as.factor(fire),
enp = as.factor(enp),
uso_suelo = as.factor(uso_suelo))
# Chunk 6
datos = datos |>
mutate(orientacion = cut(orientacion,
breaks = c(-Inf,-1,22.5,67.5,112.5,157.5,202.5,247.5,292.5,337.5,360),
labels = c("Plano","N","NE","E","SE","S","SW","W","NW","N")))
# Chunk 7
datos = datos |>
mutate(WD10M = cut(WD10M,
breaks = c(0,22.5,67.5,112.5,157.5,202.5,247.5,292.5,337.5,360),
labels = c("N","NE","E","SE","S","SW","W","NW","N")))
# Chunk 8
datos <- datos |>
mutate(uso_suelo = uso_suelo |>
as.character() |>
str_sub(0,2) |>
as.factor())
# Chunk 9
summary(datos)
# Chunk 10
Andalucia <- esp_get_ccaa(ccaa = "Andalucía")
andalucia_proj <- st_transform(Andalucia,st_crs(dataset))
plot(st_geometry(andalucia_proj),reset=F)
datos |>
filter(is.na(pendiente)| is.na(orientacion) | is.na(curvatura)) |>
st_geometry() |>
plot(pch=16,col="red",add=T)
datos |>
st_drop_geometry() |>
filter(is.na(pendiente)| is.na(orientacion) | is.na(curvatura)) |>
count() #53 observaciones NA
# Chunk 11
datos = datos |>
filter(!(is.na(pendiente)| is.na(orientacion) | is.na(curvatura)))
# Chunk 12
datos |>
st_drop_geometry() |>
filter(is.na(poblacion)) |>
mutate(Año = year(date)) |>
select(Año,municipio,cod_municipio)
datos |>
st_drop_geometry() |>
filter(is.na(poblacion)) |>
count()
# Chunk 13
pob = read_csv2("D:/usuario/Documents/Universidad/5º/TFG - organizado/data_raw/antropologicas/Población/poblacion_municipios.txt")[,c(1:5)]
pob |> filter(CODIGO_INE3 == "18077")
# Chunk 14
datos %<>% filter(!is.na(poblacion))
plot(st_geometry(andalucia_proj),reset=F)
dataset |> filter(is.na(uso_suelo)) |> st_geometry() |> plot(pch=16,col="red",add=T)
dataset |> filter(is.na(uso_suelo)) %>% count()
knitr::opts_knit$set(root.dir = "D:/usuario/Documents/Universidad/5º/TFG - organizado") # Para que haga knitr desde el directorio del proyecto
# Librerías:
library(tidyverse) # Manipulación de datos
library(sf) # Vector data
# Librerías:
library(tidyverse) # Manipulación de datos
library(sf) # Vector data
library(terra) # Raster data
library(mapSpain) # Polígonos de regiones de España
library(magrittr) # Operador %<>%
# load("salidas_intermedias/dataset_completo2024-03-27.RData")
load("salidas_intermedias/dataset_strat_completo2024-04-26.RData")
str(dataset)
datos = dataset |>
select(-c(YEAR,MM,DD))
summary(datos)
datos <- datos |>
mutate(fire = as.factor(fire),
enp = as.factor(enp),
uso_suelo = as.factor(uso_suelo))
datos = datos |>
mutate(orientacion = cut(orientacion,
breaks = c(-Inf,-1,22.5,67.5,112.5,157.5,202.5,247.5,292.5,337.5,360),
labels = c("Plano","N","NE","E","SE","S","SW","W","NW","N")))
datos = datos |>
mutate(WD10M = cut(WD10M,
breaks = c(0,22.5,67.5,112.5,157.5,202.5,247.5,292.5,337.5,360),
labels = c("N","NE","E","SE","S","SW","W","NW","N")))
datos <- datos |>
mutate(uso_suelo = uso_suelo |>
as.character() |>
str_sub(0,2) |>
as.factor())
summary(datos)
Andalucia <- esp_get_ccaa(ccaa = "Andalucía")
andalucia_proj <- st_transform(Andalucia,st_crs(dataset))
plot(st_geometry(andalucia_proj),reset=F)
datos |>
filter(is.na(pendiente)| is.na(orientacion) | is.na(curvatura)) |>
st_geometry() |>
plot(pch=16,col="red",add=T)
datos |>
st_drop_geometry() |>
filter(is.na(pendiente)| is.na(orientacion) | is.na(curvatura)) |>
count() #53 observaciones NA
datos = datos |>
filter(!(is.na(pendiente)| is.na(orientacion) | is.na(curvatura)))
datos |>
st_drop_geometry() |>
filter(is.na(poblacion)) |>
mutate(Año = year(date)) |>
select(Año,municipio,cod_municipio)
datos |>
st_drop_geometry() |>
filter(is.na(poblacion)) |>
count()
datos %<>% filter(!is.na(poblacion))
plot(st_geometry(andalucia_proj),reset=F)
dataset |> filter(is.na(uso_suelo)) %>% count()
dataset |> filter(is.na(uso_suelo)) |> st_geometry() |> plot(pch=16,col="red",add=T)
datos$uso_suelo %>% summary()
datos = datos |>
filter(!is.na(uso_suelo))
summary(dataset$NDVI)
summary(datos$NDVI)
plot(st_geometry(andalucia_proj),reset=F)
dataset |> filter(is.na(NDVI)) |> st_geometry() |> plot(pch=16,col="red",add=T)
table(datos$fire,datos$NDVI)
table(datos$fire)
table(datos$fire,is.na(datos$NDVI))
datos %<>% filter(!is.na(NDVI))
datos$NDVI
sum(!complete.cases(dataset))
dataset %>% apply(1,anyNA)
dataset %>% apply(1,anyNA) %>% sum()
# Librerías:
library(tidyverse) # Manipulación de datos
library(sf) # Vector data
library(terra) # Raster data
library(mapSpain) # Polígonos de regiones de España
library(magrittr) # Operador %<>%
datos = dataset |>
select(-c(YEAR,MM,DD))
# load("salidas_intermedias/dataset_completo2024-03-27.RData")
load("salidas_intermedias/dataset_strat_completo2024-04-26.RData")
datos = dataset |>
select(-c(YEAR,MM,DD))
summary(datos)
datos <- datos |>
mutate(fire = as.factor(fire),
enp = as.factor(enp),
uso_suelo = as.factor(uso_suelo))
datos = datos |>
mutate(orientacion = cut(orientacion,
breaks = c(-Inf,-1,22.5,67.5,112.5,157.5,202.5,247.5,292.5,337.5,360),
labels = c("Plano","N","NE","E","SE","S","SW","W","NW","N")))
datos = datos |>
mutate(WD10M = cut(WD10M,
breaks = c(0,22.5,67.5,112.5,157.5,202.5,247.5,292.5,337.5,360),
labels = c("N","NE","E","SE","S","SW","W","NW","N")))
datos <- datos |>
mutate(uso_suelo = uso_suelo |>
as.character() |>
str_sub(0,2) |>
as.factor())
summary(datos)
dataset %>% apply(1,anyNA) %>% sum()
nas = dataset %>% apply(1,anyNA) %>% sum()
nas/nrow(dataset)
table(dataset %>% apply(1,anyNA),datos$fire)
nas
nas/nrow(dataset) #
table(dataset %>% apply(1,anyNA),datos$fire)
table(dataset %>% apply(1,anyNA),datos$fire) %>% prop.table(2)
table(dataset %>% apply(1,anyNA),datos$fire) %>% prop.table(1)
table(dataset %>% apply(1,anyNA),datos$fire) %>% prop.table(1) %>% .*100
table(dataset %>% apply(1,anyNA),datos$fire) %>% prop.table(1) %>% *100
table(dataset %>% apply(1,anyNA),datos$fire) %>% prop.table(1) %>%
```
table(dataset %>% apply(1,anyNA),datos$fire) %>% prop.table(1)
datos1 = datos %>% filter(!is.na)
datos1 = datos %>% na.rm()
datos1 = datos %>% drop_na()
datos = datos %>% drop_na()
save(datos, file = paste0("salidas_intermedias/datos_strat_depurados_geom_",Sys.Date(),".RData"))
save(datos1=datos, file = paste0("salidas_intermedias/datos_strat_depurados_geom_",Sys.Date(),".RData")) # datos sin
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "D:/usuario/Documents/Universidad/5º/TFG - organizado") # Para que haga knitr desde el directorio del proyecto
# Librerías:
library(tidyverse) # Manipulación de datos
library(sf) # Vector data
library(terra) # Raster data
library(mapSpain) # Polígonos de regiones de España
library(magrittr) # Operador %<>%
# Chunk 2
# load("salidas_intermedias/dataset_completo2024-03-27.RData")
load("salidas_intermedias/dataset_strat_completo2024-04-26.RData")
str(dataset)
# Chunk 3
datos = dataset |>
select(-c(YEAR,MM,DD))
# Chunk 4
summary(datos)
# Chunk 5
datos <- datos |>
mutate(fire = as.factor(fire),
enp = as.factor(enp),
uso_suelo = as.factor(uso_suelo))
# Chunk 6
datos = datos |>
mutate(orientacion = cut(orientacion,
breaks = c(-Inf,-1,22.5,67.5,112.5,157.5,202.5,247.5,292.5,337.5,360),
labels = c("Plano","N","NE","E","SE","S","SW","W","NW","N")))
# Chunk 7
datos = datos |>
mutate(WD10M = cut(WD10M,
breaks = c(0,22.5,67.5,112.5,157.5,202.5,247.5,292.5,337.5,360),
labels = c("N","NE","E","SE","S","SW","W","NW","N")))
# Chunk 8
datos <- datos |>
mutate(uso_suelo = uso_suelo |>
as.character() |>
str_sub(0,2) |>
as.factor())
# Chunk 9
summary(datos)
nas = dataset %>% apply(1,anyNA) %>% sum()
nas # 200 registoros incompletos
nas/nrow(dataset) # aproximadamente un 0.1% de los registros
table(dataset %>% apply(1,anyNA),datos$fire) %>% prop.table(1)
# 68% de los valores faltantes en casos negativos y 32% en los positivos
datos1 = datos %>% drop_na()
save(datos=datos1, file = paste0("salidas_intermedias/datos_strat_depurados_geom_",Sys.Date(),".RData")) # datos sin
load("salidas_intermedias/datos_strat_depurados_geom_2024-05-03.RData")
load("salidas_intermedias/datos_strat_depurados_geom_2024-05-03.RData")
?save
Andalucia <- esp_get_ccaa(ccaa = "Andalucía")
andalucia_proj <- st_transform(Andalucia,st_crs(dataset))
datos = datos1
save(datos = datos1,
file = paste0("salidas_intermedias/datos_strat_depurados_geom_",Sys.Date(),".RData")) # datos sin
load("salidas_intermedias/datos_strat_depurados_geom_2024-05-03.RData")
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "D:/usuario/Documents/Universidad/5º/TFG - organizado") # Para que haga knitr desde el directorio del proyecto
# Librerías:
library(tidyverse) # Manipulación de datos
library(sf) # Vector data
library(terra) # Raster data
library(mapSpain) # Polígonos de regiones de España
library(magrittr) # Operador %<>%
# Chunk 2
# load("salidas_intermedias/dataset_completo2024-03-27.RData")
load("salidas_intermedias/dataset_strat_completo2024-04-26.RData")
str(dataset)
# Chunk 3
datos = dataset |>
select(-c(YEAR,MM,DD))
# Chunk 4
summary(datos)
# Chunk 5
datos <- datos |>
mutate(fire = as.factor(fire),
enp = as.factor(enp),
uso_suelo = as.factor(uso_suelo))
# Chunk 6
datos = datos |>
mutate(orientacion = cut(orientacion,
breaks = c(-Inf,-1,22.5,67.5,112.5,157.5,202.5,247.5,292.5,337.5,360),
labels = c("Plano","N","NE","E","SE","S","SW","W","NW","N")))
# Chunk 7
datos = datos |>
mutate(WD10M = cut(WD10M,
breaks = c(0,22.5,67.5,112.5,157.5,202.5,247.5,292.5,337.5,360),
labels = c("N","NE","E","SE","S","SW","W","NW","N")))
# Chunk 8
datos <- datos |>
mutate(uso_suelo = uso_suelo |>
as.character() |>
str_sub(0,2) |>
as.factor())
# Chunk 9
summary(datos)
nas = dataset %>% apply(1,anyNA) %>% sum()
nas # 200 registoros incompletos
nas/nrow(dataset) # aproximadamente un 0.1% de los registros
table(dataset %>% apply(1,anyNA),datos$fire) %>% prop.table(1)
# 68% de los valores faltantes en casos negativos y 32% en los positivos
# Chunk 10
datos1 = datos %>% drop_na()
datos = datos1
save(datos = datos1,
file = paste0("salidas_intermedias/datos_strat_depurados_geom_",Sys.Date(),".RData")) # datos sin
save(datos,
file = paste0("salidas_intermedias/datos_strat_depurados_geom_",Sys.Date(),".RData")) # datos sin
load("salidas_intermedias/datos_strat_depurados_geom_2024-05-03.RData")
load("salidas_intermedias/datos_strat_depurados_geom_2024-05-03.RData")
datos %>%  st_drop_geometry %>% skim()
datos %>%  st_drop_geometry %>% skim()
datos %>%
st_drop_geometry() %>%
# filter(fire==1) %>%
count(month(date,label=T),fire) %>%
rename("mes" = "month(date, label = T)") %>%
ggplot(aes(x = mes,y = n,fill=fire)) +
geom_col(position="dodge",alpha=0.8) +
theme(axis.text.x = element_text(angle = 90))
datos %>%
st_drop_geometry() %>%
# filter(fire==1) %>%
count(month(date,label=T),fire) %>%
rename("mes" = "month(date, label = T)") %>%
ggplot(aes(x = mes,y = n,fill=fire)) +
geom_col(position="dodge",alpha=0.8) +
theme(axis.text.x = element_text(angle = 90))
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "..") # Para que haga knitr desde el directorio del proyecto
datos %>%
st_drop_geometry() %>%
# filter(fire==1) %>%
count(month(date,label=T),fire) %>%
rename("mes" = "month(date, label = T)") %>%
ggplot(aes(x = mes,y = n,fill=fire)) +
geom_col(position="dodge",alpha=0.8) +
theme(axis.text.x = element_text(angle = 90))
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "..") # Para que haga knitr desde el directorio del proyecto
# Chunk 2
library(tidyverse)
library(skimr)
library(sf)
library(corrplot)
library(GGally) # Coordenadas paralelas
library(ggpubr)
# Chunk 3
load("salidas_intermedias/datos_strat_depurados_geom_2024-05-03.RData")
# Chunk 4
datos %>%  st_drop_geometry %>% skim()
datos %>%
st_drop_geometry() %>%
# filter(fire==1) %>%
count(month(date,label=T),fire) %>%
rename("mes" = "month(date, label = T)") %>%
ggplot(aes(x = mes,y = n,fill=fire)) +
geom_col(position="dodge",alpha=0.8) +
theme(axis.text.x = element_text(angle = 90))
datos %>%
st_drop_geometry() %>%
# filter(fire==1) %>%
count(month(date,label=T),fire) %>%
rename("mes" = "month(date, label = T)") %>%
ggplot(aes(x = mes,y = n,fill=fire)) +
geom_col(position="dodge",alpha=0.8) +
theme(axis.text.x = element_text(angle = 90))
datos %>%
st_drop_geometry() %>%
# filter(fire==1) %>%
count(month(date,label=T),fire) %>%
rename("mes" = "month(date, label = T)") %>%
ggplot(aes(x = mes,y = n,fill=fire)) +
geom_col(position="dodge",alpha=0.8) +
theme(axis.text.x = element_text(angle = 90))
